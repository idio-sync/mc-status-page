<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Server Info</title>
    <style>
        /* Original styles remain the same up to stats panel */
        html, body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            width: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: 'Minecraft', Arial, sans-serif;
            color: #ffffff;
            position: relative;
            background-color: #000;
        }

        .page-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(rgba(0, 0, 0, 0.0), rgba(0, 0, 0, 0.2)),
                        url('/images/backgrounds/background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Add Stats Panel Styles */
        .stats-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(21, 21, 21, 0.9);
            border-radius: 10px;
            padding: 15px 25px;
            border: 2px solid #333;
            min-width: 200px;
            text-align: center;
        }

        .stat-title {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.4em;
            color: #4CAF50;
        }

        /* Original styles continue */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
        }

        /* Rest of your original CSS... */

        /* Add World Size styles */
        .world-size {
            color: #FFD700;
        }

        /* Add Auto Start/Stop indicator styles */
        .auto-features {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .auto-feature {
            font-size: 0.8em;
            padding: 3px 8px;
            border-radius: 8px;
            background: rgba(33, 150, 243, 0.2);
            color: #90CAF9;
        }

        .auto-feature.enabled {
            background: rgba(76, 175, 80, 0.2);
            color: #A5D6A7;
        }

        /* Your existing mobile styles... */
    </style>
</head>
<body>
    <div class="page-background"></div>
    <div class="container">
        <h1>Minecraft Server Info</h1>
        
        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-title">CPU Usage</div>
                <div class="stat-value" id="cpuUsage">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Memory Usage</div>
                <div class="stat-value" id="memoryUsage">0 GB / 0 GB</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Total World Size</div>
                <div class="stat-value" id="totalWorldSize">0 GB</div>
            </div>
        </div>

        <div class="server-grid" id="serverGrid">
            <!-- Server cards will be dynamically inserted here -->
        </div>

        <!-- Map container remains the same -->
        <div class="map-container" id="mapContainer">
            <div class="map-header">
                <h2 id="mapTitle">Map View</h2>
                <div class="map-controls">
                    <button class="map-button fullscreen-map" onclick="toggleFullscreen()">
                        <span id="fullscreenText">Fullscreen</span>
                    </button>
                    <button class="map-button close-map" onclick="closeMap()">Close Map</button>
                </div>
            </div>
            <iframe id="mapFrame" class="map-frame" src=""></iframe>
        </div>
    </div>

<script>
    const servers = [
        {
            name: "Example Server",
            domain: "mc.example.com",
            port: 25565,
            craftyId: "2233e461-90db-4280-affe-4ded100a2248", // Your UUID here
            image: "/images/servers/example.jpg",
            maps: {
                dynmap: "https://mc.example.com/maps/survival/",
                bluemap: "https://mc.example.com/maps/survival-3d/"
            }
        }
        // Add more servers as needed
    ];

    function formatSize(bytes) {
        if (!bytes) return 'Unknown';
        const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
        const i = Math.floor(Math.log(bytes) / Math.log(1024));
        return `${(bytes / Math.pow(1024, i)).toFixed(2)} ${sizes[i]}`;
    }

    // Your existing helper functions remain the same
    function copyDomain(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        
        textarea.select();
        try {
            document.execCommand('copy');
            showCopyFeedback(text);
        } catch (err) {
            console.error('Failed to copy text:', err);
        }
        
        document.body.removeChild(textarea);
    }

    function showCopyFeedback(domain) {
        const domainElements = document.querySelectorAll('.domain');
        const clickedElement = Array.from(domainElements)
            .find(el => el.textContent === domain);
        
        if (clickedElement) {
            const originalText = clickedElement.textContent;
            clickedElement.textContent = 'Copied!';
            setTimeout(() => {
                clickedElement.textContent = originalText;
            }, 1000);
        }
    }

    async function checkServerStatus(domain, port, craftyId) {
        try {
            const response = await fetch(`/api/status?server=${domain}&port=${port}&craftyId=${craftyId}`);
            const data = await response.json();
            return data;
        } catch (error) {
            return {
                online: false,
                players: { online: 0, max: 0 },
                version: null,
                uptime: null,
                motd: "Failed to connect to status server",
                craftyStats: null
            };
        }
    }

    function createServerCard(server, status) {
        const escapedName = server.name.replace(/'/g, "\\'");
        const craftyStats = status.craftyStats || {};
        
        return `
            <div class="server-card">
                <img src="${server.image}" alt="${escapedName}" class="server-image">
                
                <div class="header-row">
                    <h2>${server.name}</h2>
                    <div class="server-status ${status.online ? 'online' : 'offline'}">
                        ${status.online ? 'Online' : 'Offline'}
                    </div>
                </div>
    
                <div class="info-row">
                    <div class="info-item">
                        <span class="info-label">Domain:</span>
                        <span class="domain" onclick="copyDomain('${server.domain}')">${server.domain}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">MOTD:</span>
                        <span class="motd">${status.motd}</span>
                    </div>
                </div>
    
                <div class="info-row">
                    <span class="player-count">${status.online ? `Players: ${status.players.online}/${status.players.max}` : 'Players: 0/0'}</span>
                    <span class="uptime">${status.online ? (status.craftyStats?.uptime || 'Unknown') : 'Offline'}</span>
                    <span class="version">${status.version || 'Version Unknown'}</span>
                </div>

                ${craftyStats.worldSize ? `
                <div class="info-row">
                    <span class="world-size">World Size: ${formatSize(craftyStats.worldSize)}</span>
                </div>
                ` : ''}

                ${craftyStats.autoStart !== undefined ? `
                <div class="auto-features">
                    <span class="auto-feature ${craftyStats.autoStart ? 'enabled' : ''}">
                        Auto Start: ${craftyStats.autoStart ? 'On' : 'Off'}
                    </span>
                    <span class="auto-feature ${craftyStats.autoStop ? 'enabled' : ''}">
                        Auto Stop: ${craftyStats.autoStop ? 'On' : 'Off'}
                    </span>
                </div>
                ` : ''}
    
                <div class="map-links">
                    <span class="map-link" 
                          onclick="showMap(\`${escapedName}\`, \`${server.maps.dynmap}\`, '2D')"
                          data-url="${server.maps.dynmap}">
                        2D Map
                    </span>
                    <span class="map-link" 
                          onclick="showMap(\`${escapedName}\`, \`${server.maps.bluemap}\`, '3D')"
                          data-url="${server.maps.bluemap}">
                        3D Map
                    </span>
                </div>
            </div>
        `;
    }

    async function updateServerStatuses() {
        const serverGrid = document.getElementById('serverGrid');
        serverGrid.innerHTML = '';
        
        let totalCpu = 0;
        let totalMemoryUsed = 0;
        let totalMemoryMax = 0;
        let totalWorldSize = 0;
        let serverCount = 0;

        for (const server of servers) {
            const status = await checkServerStatus(server.domain, server.port, server.craftyId);
            const cardHTML = createServerCard(server, status);
            serverGrid.innerHTML += cardHTML;

            if (status.online && status.craftyStats) {
                totalCpu += status.craftyStats.cpu || 0;
                totalMemoryUsed += status.craftyStats.memory.used || 0;
                totalMemoryMax += status.craftyStats.memory.max || 0;
                totalWorldSize += status.craftyStats.worldSize || 0;
                serverCount++;
            }
        }

        // Update stats panel
        document.getElementById('cpuUsage').textContent = 
            `${(serverCount > 0 ? totalCpu / serverCount : 0).toFixed(1)}%`;
        document.getElementById('memoryUsage').textContent = 
            `${formatSize(totalMemoryUsed)} / ${formatSize(totalMemoryMax)}`;
        document.getElementById('totalWorldSize').textContent = 
            formatSize(totalWorldSize);
    }

    // Your existing map functions remain the same
    function toggleFullscreen() {
        const mapContainer = document.getElementById('mapContainer');
        const fullscreenText = document.getElementById('fullscreenText');
        
        if (mapContainer.classList.contains('fullscreen')) {
            mapContainer.classList.remove('fullscreen');
            fullscreenText.textContent = 'Fullscreen';
            document.body.style.overflow = 'auto';
        } else {
            mapContainer.classList.add('fullscreen');
            fullscreenText.textContent = 'Exit Fullscreen';
            document.body.style.overflow = 'hidden';
        }
    }

    function showMap(serverName, mapUrl, mapType) {
        const mapContainer = document.getElementById('mapContainer');
        const mapFrame = document.getElementById('mapFrame');
        const mapTitle = document.getElementById('mapTitle');
        const serverGrid = document.getElementById('serverGrid');
        
        mapFrame.src = mapUrl;
        mapTitle.textContent = `${serverName} - ${mapType} Map`;
        
        mapContainer.classList.add('visible');
        serverGrid.classList.add('map-active');
        
        mapContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });

        document.querySelectorAll('.map-link').forEach(link => {
            link.classList.remove('active');
            if (link.dataset.url === mapUrl) {
                link.classList.add('active');
            }
        });
    }

    function closeMap() {
        const mapContainer = document.getElementById('mapContainer');
        const mapFrame = document.getElementById('mapFrame');
        const serverGrid = document.getElementById('serverGrid');
        const fullscreenText = document.getElementById('fullscreenText');
        
        mapContainer.classList.remove('visible');
        mapContainer.classList.remove('fullscreen');
        
        serverGrid.classList.remove('map-active');
        
        mapFrame.src = '';
        fullscreenText.textContent = 'Fullscreen';
        document.body.style.overflow = 'auto';

        document.querySelectorAll('.map-link').forEach(link => {
            link.classList.remove('active');
        });
    }

    // Initial update
    updateServerStatuses();

    // Update every 60 seconds
    setInterval(updateServerStatuses, 60000);
</script>
</body>
</html>
